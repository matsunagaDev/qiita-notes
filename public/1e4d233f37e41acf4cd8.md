---
title: '"Error: Failed to authenticate, have you run firebase login?"ãŒç™ºç”Ÿã—ãŸéš›ã®å¯¾å‡¦æ³•'
tags:
  - GitHub
  - Firebase
  - MarketPlace
  - GitHubActions
private: false
updated_at: '2025-03-09T18:16:28+09:00'
id: 1e4d233f37e41acf4cd8
organization_url_name: jisou
slide: false
ignorePublish: false
---
## ã¯ã˜ã‚ã«
GitHub Actions ã‚’åˆ©ç”¨ã—ã¦ CI/CD ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã‚’æ§‹ç¯‰ã—ã€Firebase ã¸ã®ãƒ‡ãƒ—ãƒ­ã‚¤ã« `FirebaseExtended/action-hosting-deploy@v0` ã‚’ä½¿ç”¨ã—ãŸã¨ã“ã‚ã€**èªè¨¼ã‚¨ãƒ©ãƒ¼** ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚ä»Šå›ã¯ã€ã‚¨ãƒ©ãƒ¼ã®è©³ç´°ã¨è§£æ±ºç­–ã‚’ã¾ã¨ã‚ã¾ã™ã€‚

## ã‚¨ãƒ©ãƒ¼å†…å®¹
Firebase ã«ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹ãŸã‚ã«ã€ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã® JSON ã‚­ãƒ¼ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å–å¾—ã—ã€ãã‚Œã‚’ã€ãã‚Œã‚’ **BASE64 ã«ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰** ã—ãŸå€¤ã‚’ GitHub Actions ã® `secrets` ã«è¨­å®šã—ã¾ã—ãŸã€‚


![Github_secrets.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/3851095/4db3d09c-9c7c-45f8-af9c-f162ac328644.png)



ãã—ã¦ã€å…¬å¼ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã®`FirebaseExtended/action-hosting-deploy@v0` ã‚’åˆ©ç”¨ã—ã¦ä»¥ä¸‹ã®ã‚ˆã†ãªymlãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã¾ã—ãŸã€‚

#### å‚è€ƒã«ã—ãŸãƒ‡ãƒ—ãƒ­ã‚¤æ–¹æ³•â‘ 
ğŸ”— [Deploy to Firebase Hosting (GitHub Actions)](https://github.com/marketplace/actions/deploy-to-firebase-hosting)


<details open><summary><strong>ä¿®æ­£å‰ã®yml</strong></summary>

```yml

name: CI/CD

on: [push]

jobs:
  build:
    name: Build
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: 20
          cache: 'npm'

      - name: Install dependencies
        run: npm ci

      - name: Build project
        run: npm run build

      - name: Upload dist
        uses: actions/upload-artifact@v4
        with:
          name: build
          path: dist

  deploy:
    name: Deploy
    needs: build
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Download build artifact
        uses: actions/download-artifact@v4
        with:
          name: build
          path: dist

      # ğŸ”´Firebase ã®ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚­ãƒ¼ã‚’ `secrets` ã‹ã‚‰å–å¾—
      - name: Deploy to Firebase Hosting
        uses: FirebaseExtended/action-hosting-deploy@v0
        with:
          firebaseServiceAccount: "${{ secrets.FIREBASE_SERVICE_ACCOUNT }}"
          projectId: "${{ secrets.FIREBASE_PROJECT_ID }}"
          channelId: live
```

</details>

---

### ç™ºç”Ÿã—ãŸã‚¨ãƒ©ãƒ¼

ã—ã‹ã—ã€ãƒ‡ãƒ—ãƒ­ã‚¤æ™‚ã«ä»¥ä¸‹ã®ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒè¡¨ç¤ºã•ã‚Œã€**èªè¨¼ã‚¨ãƒ©ãƒ¼** ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚
```zsh
â–¶ï¸ Deploying to production site
  /usr/local/bin/npx firebase-tools@latest deploy --only hosting --project "project-id" --json
  npm warn exec The following package was not found and will be installed: firebase-tools@13.33.0
  {
    "status": "error",
    "error": "Failed to authenticate, have you run \u001b[1mfirebase login\u001b[22m?"
  }
  
  The process '/usr/local/bin/npx' failed with exit code 1
  Retrying deploy with the --debug flag for better error output
  
  [2025-XX-XXTXX:XX:XX.XXXX] ğŸ”´ **SyntaxError: Unexpected token 'e', "eXXXXXXXX"... is not valid JSON**
      at JSON.parse (<anonymous>)
      at ReadStream.<anonymous> (/home/runner/.../google-auth-library/.../googleauth.js:511:43)
  
  Error: Failed to authenticate, have you run firebase login?

```
:::note warn
ã‚¨ãƒ©ãƒ¼ã®ãƒã‚¤ãƒ³ãƒˆ
- Failed to authenticate â†’ Firebase ã®èªè¨¼ã«å¤±æ•—
- SyntaxError: Unexpected token 'e' â†’ JSON ã®ãƒ‘ãƒ¼ã‚¹ã‚¨ãƒ©ãƒ¼ ãŒç™ºç”Ÿ
:::

æœ‰è­˜è€…ã«ã‚‚ç¢ºèªã—ãŸçµæœã€ã‚¨ãƒ©ãƒ¼ã®å†…å®¹ã‹ã‚‰ ã‚­ãƒ¼æƒ…å ±ï¼ˆJSONï¼‰ãŒé©åˆ‡ã«èª­ã¿è¾¼ã¾ã‚Œã¦ã„ãªã„ å¯èƒ½æ€§ãŒé«˜ã„ã¨åˆ¤æ–­ã—ã¾ã—ãŸã€‚

## å¯¾å¿œå†…å®¹

### â‘  ã‚­ãƒ¼æƒ…å ±ã®å†è¨­å®š
1. Firebase ã® ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆ JSON ã‚­ãƒ¼ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å†å–å¾—
2. BASE64 ã«ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã—ç›´ã—ã¦ GitHub Secrets ã«è¨­å®š

ã—ã‹ã—ã€ã“ã¡ã‚‰ã®æ–¹æ³•ã§ã¯ **åŒæ§˜ã®ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿ** ã—ã€è§£æ¶ˆã•ã‚Œã¾ã›ã‚“ã§ã—ãŸã€‚

---

### â‘¡ ãƒ‡ãƒ—ãƒ­ã‚¤æ–¹æ³•ã‚’å¤‰æ›´
å…¬å¼ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ï¼ˆFirebaseExtended/action-hosting-deployï¼‰ã‚’ä½¿ç”¨ã›ãšã€**Google Cloud ã®èªè¨¼ã‚’æ´»ç”¨ã™ã‚‹æ–¹æ³•ã¸å¤‰æ›´** ã—ã¾ã—ãŸã€‚
ã“ã®æ–¹æ³•ã«ã‚ˆã‚Šã€èªè¨¼ã‚¨ãƒ©ãƒ¼ãŒè§£æ¶ˆã•ã‚Œã€ãƒ‡ãƒ—ãƒ­ã‚¤ãŒæˆåŠŸ ã—ã¾ã—ãŸã€‚

## ğŸ“ å¤‰æ›´å†…å®¹

#### å¤‰æ›´å‰
- ä½¿ç”¨ã‚¢ã‚¯ã‚·ãƒ§ãƒ³: FirebaseExtended/action-hosting-deploy@v0
- èªè¨¼æ–¹æ³•: Firebase ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚­ãƒ¼ï¼ˆBASE64 ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ï¼‰

#### å¤‰æ›´å¾Œ
- ä½¿ç”¨ã‚¢ã‚¯ã‚·ãƒ§ãƒ³: google-github-actions/auth@v2
- èªè¨¼æ–¹æ³•: 
        1. Google Cloud èªè¨¼ï¼ˆOIDCï¼‰
        2. Firebase CLI ã‚’æ‰‹å‹•å®Ÿè¡Œ

#### å‚è€ƒã«ã—ãŸãƒ‡ãƒ—ãƒ­ã‚¤æ–¹æ³•â‘¡

ğŸ”— [Enabling Keyless Authentication from GitHub Actions](https://cloud.google.com/blog/products/identity-security/enabling-keyless-authentication-from-github-actions?hl=en)

---

<details open><summary><strong>ä¿®æ­£å¾Œã®yml</strong></summary>

```yml
name: CI/CD

on: [push]

jobs:
  build:
    name: Build
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: 20
          cache: 'npm'

      - name: Install dependencies
        run: npm ci

      - name: Build project
        run: npm run build

      - name: Upload dist
        uses: actions/upload-artifact@v4
        with:
          name: build
          path: dist

  deploy:
    name: Deploy
    needs: build
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Download build artifact
        uses: actions/download-artifact@v4
        with:
          name: build
          path: dist

      # ğŸ”µ **Google Cloud èªè¨¼ï¼ˆOIDCï¼‰**
      - name: Authenticate to Google Cloud
        uses: google-github-actions/auth@v2
        with:
          credentials_json: ${{ secrets.FIREBASE_SERVICE_ACCOUNT }}

      # ğŸ”µ **Firebase CLI ã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—**
      - name: Setup Firebase CLI
        run: npm install -g firebase-tools

      # ğŸ”µ **Firebase ã¸ãƒ‡ãƒ—ãƒ­ã‚¤**
      - name: Deploy to Firebase
        run: firebase deploy --only hosting
        env:
          FIREBASE_PROJECT_ID: ${{ secrets.FIREBASE_PROJECT_ID }}

```

</details>


## çµ‚ã‚ã‚Šã«
ä»Šå›ã¯ `Firebase` ã®å…¬å¼ `GitHub Actions` ã‚’ä½¿ç”¨ã—ãŸãƒ‡ãƒ—ãƒ­ã‚¤ã§èªè¨¼ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ãŸãŸã‚ã€`Google Cloud` ã®èªè¨¼ã‚’ç”¨ã„ã‚‹æ–¹æ³•ã«åˆ‡ã‚Šæ›¿ãˆã¾ã—ãŸã€‚
ä»Šå¾Œã€åŸå› ã®è©³ç´°ã‚’èª¿æŸ»ã—ã€å¯èƒ½ã§ã‚ã‚Œã°å…¬å¼ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã®åˆ©ç”¨ã«å†æŒ‘æˆ¦ã—ãŸã„ã¨è€ƒãˆã¦ã„ã¾ã™ï¼


## å‚è€ƒã‚µã‚¤ãƒˆ

https://github.com/marketplace/actions/deploy-to-firebase-hosting

https://cloud.google.com/blog/products/identity-security/enabling-keyless-authentication-from-github-actions?hl=en
